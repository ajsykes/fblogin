"use strict";angular.module("groupAlarmApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase","angular-carousel"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/lists",{templateUrl:"views/lists.html"}).when("/alarm/:id",{templateUrl:"views/alarm/view.html",controller:"AlarmCtrl"}).when("/alarm/:id/edit",{templateUrl:"views/alarm/edit.html",controller:"AlarmCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("groupAlarmApp").controller("TitleBarCtrl",["$scope","titleBar","$location",function(a,b,c){a.leftButtons=[],a.rightButtons=[],a.$on("titleBar.leftButtonAdded",function(){a.leftButtons=b.getButtons(b.LEFT)}),a.$on("titleBar.rightButtonAdded",function(){a.rightButtons=b.getButtons(b.RIGHT)}),a.$on("titleBar.leftCleared",function(){a.leftButtons=[]}),a.$on("titleBar.rightCleared",function(){a.rightButtons=[]}),a.announce=function(a){b.clicked(a)},a.lists=function(){c.path("/lists")}}]),angular.module("groupAlarmApp").controller("AlarmsCtrl",["$scope","$rootScope","$location","$firebase","$filter",function(a,b,c,d,e){function f(){var a={};a.name="New Alarm - "+e("date")(new Date,"MMM d"),a.owner=b.user.id,a.users={},a.users[b.user.id]={},a.users[b.user.id].name=b.user.displayName,a.users[b.user.id].hour=12,a.users[b.user.id].minute=30,a.users[b.user.id].meridiem="PM",a.users[b.user.id].days={},a.users[b.user.id].days.sunday=!1,a.users[b.user.id].days.monday=!1,a.users[b.user.id].days.tuesday=!1,a.users[b.user.id].days.wednesday=!1,a.users[b.user.id].days.thursday=!1,a.users[b.user.id].days.friday=!1,a.users[b.user.id].days.saturday=!1,a.users[b.user.id].repeat=!1,a.users[b.user.id].status="ON",a.permissions={},a.permissions[b.user.id]=!0;var d=h.push();d.set(a);var f={};f[d.name()]=!0,g.$update(f),c.path("/alarm/"+d.name()+"/edit")}if("undefined"==typeof b.user||null===b.user)return void c.path("/");var g=d(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/alarms")),h=new Firebase("https://brilliant-fire-1384.firebaseio.com/alarms");a.userId=b.user.id,a.alarms=[],g.$on("loaded",function(){a.alarms=[];var b=g.$getIndex();b.forEach(function(b){a.alarms.push(d(h.child(b)))})}),g.$on("change",function(){a.alarms=[];var b=g.$getIndex();b.forEach(function(b){a.alarms.push(d(h.child(b)))})}),a.$on("alarms.add",function(){f()}),a.view=function(a){c.path("/alarm/"+a)},a.toggleStatus=function(a){a.status="ON"===a.status?"OFF":"ON"}}]),angular.module("groupAlarmApp").controller("TimersCtrl",["$scope","$rootScope","$location","$firebase",function(a,b,c,d){if("undefined"==typeof b.user||null===b.user)return void c.path("/");var e=d(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/timers")),f=new Firebase("https://brilliant-fire-1384.firebaseio.com/timers");a.timers=[],e.$on("change",function(){a.timers=[];var b=e.$getIndex();b.forEach(function(b){a.timers.push(d(f.child(b)))})}),b.$on("timers.add",function(){c.path("/add/timer")}),a.addTimer=function(){var a={};a.name="Testing Timer",a.permissions={},a.permissions[b.user.id]=!0;var c=f.push();c.set(a);var d={};d[c.name()]=!0,e.$update(d)}}]),angular.module("groupAlarmApp").controller("GroupsCtrl",["$scope","$rootScope","$firebase","$location",function(a,b,c,d){if("undefined"==typeof b.user||null===b.user)return void d.path("/");var e=c(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/groups")),f=new Firebase("https://brilliant-fire-1384.firebaseio.com/groups");a.groups=[],e.$on("change",function(){a.groups=[];var b=e.$getIndex();b.forEach(function(b){a.groups.push(c(f.child(b)))})}),b.$on("groups.add",function(){d.path("/add/group")}),a.addGroup=function(){var a={};a.name="Testing group",a.permissions={},a.permissions[b.user.id]=!0;var c=f.push();c.set(a);var d={};d[c.name()]=!0,e.$update(d)}}]),angular.module("groupAlarmApp").controller("AuthCtrl",["$scope","$rootScope","$firebaseSimpleLogin","$location",function(a,b,c,d){var e=new Firebase("https://brilliant-fire-1384.firebaseio.com");a.loginobj=c(e),a.logout=function(){a.loginobj.$logout()},a.login=function(){"undefined"==typeof FB?(console.log("POPUP LOGIN"),a.performLogin()):(FB.login(),console.log("START LOGIN"))},a.performLogin=function(c){var e={};console.log("PERFORM LOGIN"),"undefined"!=typeof FB&&""!==c&&(e.access_token=c,console.log("USING TOKEN")),a.loginobj.$login("facebook",e).then(function(a){console.log("user"+JSON.stringify(a)),b.user=a,d.path("lists")})}}]),angular.module("groupAlarmApp").controller("ListCtrl",["$scope","$rootScope","titleBar",function(a,b,c){a.tabIndex=0,a.tabs=["Alarms","Timers","Groups"],c.addButton(c.RIGHT,{content:'<i class="fa fa-plus"></i>',click:function(){b.$broadcast(a.tabs[a.tabIndex].toLowerCase()+".add")}})}]),angular.module("groupAlarmApp").controller("AlarmCtrl",["$scope","$rootScope","titleBar","$location","$firebase","$routeParams",function(a,b,c,d,e,f){if("undefined"==typeof b.user)return void d.path("/lists");var g=new Firebase("https://brilliant-fire-1384.firebaseio.com/alarms/").child(f.id),h=e(g.child("users").child(b.user.id));g=e(g),g.$bind(a,"alarm"),h.$bind(a,"myAlarm");var i={};d.absUrl().indexOf("edit")>-1?(i.content='<i class="fa fa-floppy-o"></i>',i.click=function(){window.history.back()}):(i.content='<i class="fa fa-pencil"></i>',i.click=function(){d.path("/alarm/"+f.id+"/edit")}),c.addButton(c.RIGHT,i),c.addButton(c.LEFT,{content:'<i class="fa fa-angle-left"></i>',click:function(){window.history.back()}}),g.$on("loaded",function(){g.owner===b.user.id&&-1===d.absUrl().indexOf("edit")&&c.addButton(c.RIGHT,{content:'<i class="fa fa-trash-o"></i>',click:function(){d.path("/lists"),a.alarm.$remove();var c=new Firebase("https://brilliant-fire-1384.firebaseio.com/users/").child(b.user.id).child("alarms").child(f.id);e(c).$remove()}})}),a.toggleMeridiem=function(){a.myAlarm.meridiem="AM"===a.myAlarm.meridiem?"PM":"AM"},a.hoursUp=function(){a.myAlarm.hour=a.myAlarm.hour%12+1},a.hoursDown=function(){a.myAlarm.hour=(a.myAlarm.hour+10)%12+1},a.minutesUp=function(){a.myAlarm.minute=(a.myAlarm.minute+61)%60},a.minutesDown=function(){a.myAlarm.minute=(a.myAlarm.minute+59)%60},a.toggleDay=function(b){"undefined"==typeof a.myAlarm.days&&(a.myAlarm.days={}),a.myAlarm.days[b]=a.myAlarm.days[b]===!0?!1:!0}}]),angular.module("groupAlarmApp").factory("titleBar",["$rootScope",function(a){var b={};b.LEFT="left",b.RIGHT="right";var c=[],d=[];return b.addButton=function(b,e){b===this.LEFT?c.push(e):d.push(e),a.$broadcast("titleBar."+b.toLowerCase()+"ButtonAdded")},b.getButtons=function(a){return a===this.LEFT?c:d},b.clear=function(b){return"undefined"==typeof b?(c=[],d=[],a.$broadcast("titleBar.leftCleared"),void a.$broadcast("titleBar.rightCleared")):(b===this.LEFT?c=[]:d=[],void a.$broadcast("titleBar."+b.toLowerCase()+"Cleared"))},b.clicked=function(a){"undefined"!=typeof a.click&&a.click()},a.$on("$locationChangeStart",function(){b.clear()}),b}]),angular.module("groupAlarmApp").filter("notOwner",["$rootScope",function(a){return function(b){return"undefined"==typeof b?b:(delete b[a.user.id],b)}}]);