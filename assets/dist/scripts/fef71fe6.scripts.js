"use strict";angular.module("groupAlarmApp",["ngCookies","ngResource","ngSanitize","ngRoute","firebase","angular-carousel"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html"}).when("/lists",{templateUrl:"views/lists.html"}).when("/alarm/:id",{templateUrl:"views/alarm/view.html",controller:"AlarmCtrl"}).when("/alarm/:id/edit",{templateUrl:"views/alarm/edit.html",controller:"AlarmCtrl"}).when("/add/friend/:module/:id",{templateUrl:"views/friendadder.html",controller:"FriendAdderCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("groupAlarmApp").controller("TitleBarCtrl",["$scope","titleBar","$location",function(a,b,c){a.leftButtons=[],a.rightButtons=[],a.$on("titleBar.leftButtonAdded",function(){a.leftButtons=b.getButtons(b.LEFT)}),a.$on("titleBar.rightButtonAdded",function(){a.rightButtons=b.getButtons(b.RIGHT)}),a.$on("titleBar.leftCleared",function(){a.leftButtons=[]}),a.$on("titleBar.rightCleared",function(){a.rightButtons=[]}),a.announce=function(a){b.clicked(a)},a.lists=function(){c.path("/lists")}}]),angular.module("groupAlarmApp").controller("AlarmsCtrl",["$scope","$rootScope","$location","$firebase","$filter",function(a,b,c,d,e){function f(){var a={};a.name="New Alarm - "+e("date")(new Date,"MMM d"),a.owner=b.user.id,a.users={},a.users[b.user.id]={},a.users[b.user.id].name=b.user.displayName,a.hour=12,a.minute=30,a.meridiem="PM",a.users[b.user.id].offsetMinutes=30,a.days={},a.days.sunday=!0,a.days.monday=!0,a.days.tuesday=!0,a.days.wednesday=!0,a.days.thursday=!0,a.days.friday=!0,a.days.saturday=!0,a.repeat=!0,a.users[b.user.id].status="ON",a.permissions={},a.permissions[b.user.id]=!0;var d=h.push();d.set(a);var f={};f[d.name()]=!0,g.$update(f),c.path("/alarm/"+d.name()+"/edit")}if("undefined"==typeof b.user||null===b.user)return void c.path("/");var g=d(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/alarms")),h=new Firebase("https://brilliant-fire-1384.firebaseio.com/alarms");a.userId=b.user.id,a.alarms=[],g.$on("loaded",function(){a.alarms=[];var b=g.$getIndex();b.forEach(function(b){a.alarms.push(d(h.child(b)))})}),g.$on("change",function(){a.alarms=[];var b=g.$getIndex();b.forEach(function(b){a.alarms.push(d(h.child(b)))})}),a.$on("alarms.add",function(){f()}),a.view=function(a){c.path("/alarm/"+a)},a.toggleStatus=function(c){console.log(a.alarms[c].$child("users").$child(b.user.id).status),a.alarms[c].$child("users").$child(b.user.id).$update("ON"===a.alarms[c].$child("users").$child(b.user.id).status?{status:"OFF"}:{status:"ON"})}}]),angular.module("groupAlarmApp").controller("TimersCtrl",["$scope","$rootScope","$location","$firebase",function(a,b,c,d){if("undefined"==typeof b.user||null===b.user)return void c.path("/");var e=d(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/timers")),f=new Firebase("https://brilliant-fire-1384.firebaseio.com/timers");a.timers=[],e.$on("change",function(){a.timers=[];var b=e.$getIndex();b.forEach(function(b){a.timers.push(d(f.child(b)))})}),b.$on("timers.add",function(){c.path("/add/timer")}),a.addTimer=function(){var a={};a.name="Testing Timer",a.permissions={},a.permissions[b.user.id]=!0;var c=f.push();c.set(a);var d={};d[c.name()]=!0,e.$update(d)}}]),angular.module("groupAlarmApp").controller("GroupsCtrl",["$scope","$rootScope","$firebase","$location",function(a,b,c,d){if("undefined"==typeof b.user||null===b.user)return void d.path("/");var e=c(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+b.user.id+"/groups")),f=new Firebase("https://brilliant-fire-1384.firebaseio.com/groups");a.groups=[],e.$on("change",function(){a.groups=[];var b=e.$getIndex();b.forEach(function(b){a.groups.push(c(f.child(b)))})}),b.$on("groups.add",function(){d.path("/add/group")}),a.addGroup=function(){var a={};a.name="Testing group",a.permissions={},a.permissions[b.user.id]=!0;var c=f.push();c.set(a);var d={};d[c.name()]=!0,e.$update(d)}}]),angular.module("groupAlarmApp").controller("AuthCtrl",["$scope","$rootScope","$firebaseSimpleLogin","$location",function(a,b,c,d){var e=new Firebase("https://brilliant-fire-1384.firebaseio.com");a.loginobj=c(e),a.logout=function(){a.loginobj.$logout()},a.login=function(){"undefined"==typeof FB?a.performLogin():FB.login()},a.performLogin=function(c){var e={};"undefined"!=typeof FB&&""!==c&&(e.access_token=c),a.loginobj.$login("facebook",e).then(function(a){b.user=a,d.path("/lists")},function(a){console.log(a)})}}]),angular.module("groupAlarmApp").controller("ListCtrl",["$scope","$rootScope","titleBar",function(a,b,c){a.tabIndex=0,a.tabs=["Alarms","Timers","Groups"],c.addButton(c.RIGHT,{content:'<i class="fa fa-plus"></i>',click:function(){b.$broadcast(a.tabs[a.tabIndex].toLowerCase()+".add")}})}]),angular.module("groupAlarmApp").controller("AlarmCtrl",["$scope","$rootScope","titleBar","$location","$firebase","$routeParams",function(a,b,c,d,e,f){if("undefined"==typeof b.user)return void d.path("/lists");var g=new Firebase("https://brilliant-fire-1384.firebaseio.com/alarms/").child(f.id),h=e(g.child("users").child(b.user.id));g=e(g),g.$bind(a,"alarm"),h.$bind(a,"myAlarm");var i={};d.absUrl().indexOf("edit")>-1?(i.content='<i class="fa fa-floppy-o"></i>',i.click=function(){window.history.back()}):(i.content='<i class="fa fa-pencil"></i>',i.click=function(){d.path("/alarm/"+f.id+"/edit")}),c.addButton(c.RIGHT,i),c.addButton(c.LEFT,{content:'<i class="fa fa-angle-left"></i>',click:function(){window.history.back()}}),g.$on("loaded",function(){g.owner===b.user.id&&-1===d.absUrl().indexOf("edit")&&c.addButton(c.RIGHT,{content:'<i class="fa fa-trash-o"></i>',click:function(){var c=new Firebase("https://brilliant-fire-1384.firebaseio.com/users/").child(b.user.id).child("alarms").child(f.id);e(c).$remove(),a.alarm.$child("users").$remove(b.user.id),a.alarm.$child("permissions").$remove(b.user.id),d.path("/lists")}})}),a.toggleMeridiem=function(){a.alarm.meridiem="AM"===a.alarm.meridiem?"PM":"AM"},a.hoursUp=function(){a.alarm.hour=a.alarm.hour%12+1},a.hoursDown=function(){a.alarm.hour=(a.alarm.hour+10)%12+1},a.minutesUp=function(){a.alarm.minute=(a.alarm.minute+61)%60},a.minutesDown=function(){a.alarm.minute=(a.alarm.minute+59)%60},a.offsetUp=function(){a.myAlarm.offsetMinutes=a.myAlarm.offsetMinutes%90+1},a.offsetDown=function(){a.myAlarm.offsetMinutes=(a.myAlarm.offsetMinutes+88)%90+1},a.toggleDay=function(b){a.alarm.days[b]=a.alarm.days[b]===!0?!1:!0},a.addFriend=function(){d.path("/add/friend/alarm/"+f.id)}}]),angular.module("groupAlarmApp").controller("FriendAdderCtrl",["$scope","$rootScope","titleBar","$firebase","$location","$http","$routeParams",function(a,b,c,d,e,f,g){if("undefined"==typeof b.user)return void e.path("/");var h=new Firebase("https://brilliant-fire-1384.firebaseio.com/alarms/").child(g.id),i=h.child("users");c.addButton(c.LEFT,{content:'<i class="fa fa-angle-left"></i>',click:function(){window.history.back()}}),a.toggle=function(a){if(!(a.uid in h)){var b={},c={};c.name=a.name,c.offsetMinutes=30,c.status="ON",b[a.uid]=c,d(i).$update(b),b[a.uid]=!0,d(h.child("permissions")).$update(b);var e=d(new Firebase("https://brilliant-fire-1384.firebaseio.com/users/"+a.uid+"/alarms"));b={},b[g.id]=!0,e.$update(b)}},f.get("https://graph.facebook.com/fql?q="+encodeURIComponent("SELECT uid, name, pic_square FROM user WHERE is_app_user=1 AND uid IN (SELECT uid2 FROM friend WHERE uid1 = me())")+"&access_token="+b.user.accessToken).success(function(b){a.friends=b.data})}]),angular.module("groupAlarmApp").factory("titleBar",["$rootScope",function(a){var b={};b.LEFT="left",b.RIGHT="right";var c=[],d=[];return b.addButton=function(b,e){b===this.LEFT?c.push(e):d.push(e),a.$broadcast("titleBar."+b.toLowerCase()+"ButtonAdded")},b.getButtons=function(a){return a===this.LEFT?c:d},b.clear=function(b){return"undefined"==typeof b?(c=[],d=[],a.$broadcast("titleBar.leftCleared"),void a.$broadcast("titleBar.rightCleared")):(b===this.LEFT?c=[]:d=[],void a.$broadcast("titleBar."+b.toLowerCase()+"Cleared"))},b.clicked=function(a){"undefined"!=typeof a.click&&a.click()},a.$on("$locationChangeStart",function(){b.clear()}),b}]),angular.module("groupAlarmApp").filter("notOwner",["$rootScope",function(a){return function(b){if("undefined"==typeof b)return b;var c=angular.copy(b);return delete c[a.user.id],c}}]),angular.module("groupAlarmApp").service("AlarmManager",["$window","$rootScope",function a(b,c){function d(a){for(var b=0,c=0;c<a.length;c++)b+=e.indexOf(a.charAt(c));return b}var a={},e="-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split("");return a.setAlarm=function(a){angular.Foreach(a.days,function(e,f){var g=d(a.$id),h=a.hour+":"+a.minutes+" "+a.meridien,i=a.users[c.user.id].offsetMinutes;"undefined"==typeof b.FB?console.log("SETTING ALARM : "+a+" "+f+" "+i):b.FB.set(h,f,i,g)})},a.cancelAlarm=function(a){var c=d(a.$id);"undefined"==typeof b.FB?console.log("CANCELLED ALARM : "+a+" "+key+" "+offset):b.FB.cancel(c)},a}]);